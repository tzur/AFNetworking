<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OCHamcrest: Writing custom matchers</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OCHamcrest
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Writing custom matchers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>OCHamcrest comes bundled with lots of useful matchers, but you'll probably find that you need to create your own from time to time to fit your testing needs.</p>
<p>This commonly occurs when you find a fragment of code that tests the same set of properties over and over again (and in different tests), and you want to bundle the fragment into a single assertion. By writing your own matcher you'll eliminate code duplication and make your tests more readable!</p>
<p>Let's write our own matcher for testing if a calendar date falls on a Saturday. This is the test we want to write:</p>
<div class="fragment"><pre class="fragment">- (void)testDateIsOnASaturday
{
    NSCalendarDate* date = [NSCalendarDate dateWithString:<span class="stringliteral">@&quot;26 Apr 2008&quot;</span> calendarFormat:<span class="stringliteral">@&quot;%d %b %Y&quot;</span>];
    <a class="code" href="group__integration.html#ga75b04fe22150cca452998ada49d3e458" title="assertThat(actual, matcher) - Asserts that actual value satisfies matcher.">assertThat</a>(date, <a class="code" href="group__decorator__matchers.html#ga9870e0caa2f8e3e5700c4cbb21d73c07" title="is(aMatcher) - Decorates another matcher, or provides a shortcut to the frequently used is(equalTo(x)...">is</a>(onASaturday()))
}
</pre></div><p>Here's the interface:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#import &lt;OCHamcrest/HCBaseMatcher.h&gt;</span>
<span class="preprocessor">#import &lt;objc/objc-api.h&gt;</span>

<span class="keyword">@interface </span>IsGivenDayOfWeek : <a class="code" href="interface_h_c_base_matcher.html" title="Base class for all HCMatcher implementations.">HCBaseMatcher</a>
{
    NSInteger day;      <span class="comment">// Sunday is 0, Saturday is 6</span>
}

+ (instancetype)isGivenDayOfWeek:(NSInteger)dayOfWeek;
- (instancetype)initWithDay:(NSInteger)dayOfWeek;

<span class="keyword">@end</span>

OBJC_EXPORT id &lt;HCMatcher&gt; onASaturday();
</pre></div><p>The interface consists of two parts: a class definition, and a factory function (with C binding). Here's what the implementation looks like:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#import &quot;IsGivenDayOfWeek.h&quot;</span>
<span class="preprocessor">#import &lt;OCHamcrest/HCDescription.h&gt;</span>

<span class="keyword">@implementation </span>IsGivenDayOfWeek

+ (instancetype)isGivenDayOfWeek:(NSInteger)dayOfWeek
{
    <span class="keywordflow">return</span> [[<span class="keyword">self</span> alloc] initWithDay:dayOfWeek];
}

- (instancetype)initWithDay:(NSInteger)dayOfWeek
{
    <span class="keyword">self</span> = [<span class="keyword">super</span> init];
    <span class="keywordflow">if</span> (<span class="keyword">self</span> != nil)
        day = dayOfWeek;
    <span class="keywordflow">return</span> <span class="keyword">self</span>;
}

<span class="comment">// Test whether item matches.</span>
- (BOOL)matches:(<span class="keywordtype">id</span>)item
{
    <span class="keywordflow">if</span> (![item respondsToSelector:<span class="keyword">@selector</span>(dayOfWeek)])
        <span class="keywordflow">return</span> NO;

    <span class="keywordflow">return</span> [item dayOfWeek] == day;
}

<span class="comment">// Describe the matcher.</span>
- (void)describeTo:(<span class="keywordtype">id</span> &lt;<a class="code" href="protocol_h_c_description-p.html" title="A description of an HCMatcher.">HCDescription</a>&gt;)description
{
    NSString *dayAsString[] =
        { <span class="stringliteral">@&quot;Sunday&quot;</span>, <span class="stringliteral">@&quot;Monday&quot;</span>, <span class="stringliteral">@&quot;Tuesday&quot;</span>, <span class="stringliteral">@&quot;Wednesday&quot;</span>, <span class="stringliteral">@&quot;Thursday&quot;</span>, <span class="stringliteral">@&quot;Friday&quot;</span>, <span class="stringliteral">@&quot;Saturday&quot;</span> };
    [[description <a class="code" href="protocol_h_c_description-p.html#ac10b708f1dbcf7537df8fea173916741" title="Appends some plain text to the description.">appendText</a>:@&quot;calendar date falling on &quot;] appendText:dayAsString[day]];
}

<span class="keyword">@end</span>


id &lt;HCMatcher&gt; onASaturday()
{
    <span class="keywordflow">return</span> [IsGivenDayOfWeek isGivenDayOfWeek:6];
}
</pre></div><p>For our Matcher implementation we implement the <code>-matches</code>: method (which calls <code>-dayOfWeek</code> after confirming that the argument has such a method) and the <code>-describe_to</code>: method (which is used to produce a failure message when a test fails). Here's an example of how the failure message looks:</p>
<div class="fragment"><pre class="fragment">NSCalendarDate* date = [NSCalendarDate dateWithString: <span class="stringliteral">@&quot;6 April 2008&quot;</span>
                                       calendarFormat: <span class="stringliteral">@&quot;%d %B %Y&quot;</span>];
<a class="code" href="group__integration.html#ga75b04fe22150cca452998ada49d3e458" title="assertThat(actual, matcher) - Asserts that actual value satisfies matcher.">assertThat</a>(date, <a class="code" href="group__decorator__matchers.html#ga9870e0caa2f8e3e5700c4cbb21d73c07" title="is(aMatcher) - Decorates another matcher, or provides a shortcut to the frequently used is(equalTo(x)...">is</a>(onASaturday()));
</pre></div><p>fails with the message</p>
<div class="fragment"><pre class="fragment">Expected: is calendar date falling on Saturday, got: &lt;06 April 2008&gt; </pre></div><p>and Xcode shows it as a build error. Clicking the error message takes you to the assertion that failed.</p>
<p>Even though the <code>onASaturday</code> function creates a new matcher each time it is called, you should not assume this is the only usage pattern for your matcher. Therefore you should make sure your matcher is stateless, so a single instance can be reused between matches. </p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 6 2013 10:25:17 for OCHamcrest by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
